name: Build and Dockerize .NET 8 API

on:
  workflow_dispatch:

env:
  IMAGE_NAME: sushovan-d/hx-aura-learning-api
  VERSION: '1.0.0'

jobs:
    build:
        steps:
            - name: Build Project
              run: dotnet build ./hx-aura-learning/hx-aura-learning.csproj --configuration Release --no-restore

            - name: Publish Project
              run: dotnet publish ./hx-aura-learning/hx-aura-learning.csproj -c Release -o ./app/publish

            - name: Set up QEMU
              uses: docker/setup-qemu-action@v3.2.0
              with:
                platforms: 'arm64,arm'

            - name: Setup Docker Build
              run: |
                docker buildx build . \
                --platform linux/arm64 \
                -t ${{ env.IMAGE_NAME }}:${{ env.VERSION }} \
                --load \
                -f ./Dockerfile
             