name: Pull Requests

on:
  pull_request:
    branches:
      - main
    types: [opened, reopened, synchronize, ready_for_review, labeled]

permissions:
  actions: read
  contents: read
  security-events: write
  checks: write

env:
  # Change these values to match your project
  API_IMAGE_NAME: blueprint-api
  PROVISIONING_LAMBDA_IMAGE_NAME: blueprint-provisioning-lamda
  SONAR_PROJECT_KEY: blueprint-api
  API_PROJECT_NAME: Hyland.Experience.Blueprint.Api
  LAMBDA_PROJECT_NAME: Hyland.Experience.Blueprint.Lambda.Provisioning

  # Below this doesn't need to change
  TEST_RESULT_PATH: .artifacts/tests

jobs:
  checkbotbuild:
    name: Check dependabot build
    if: ${{ github.event.sender.login == 'dependabot[bot]' }}
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "This workflow run was triggered by dependabot. Validate the upgraded dependencies, then add the 'CI' label to the pull request to trigger this workflow."
          exit 1

  env-setup:
    runs-on: ubuntu-latest
    if: ${{ (github.event.action != 'labeled' && github.event.sender.login != 'dependabot[bot]') || (github.event.action == 'labeled' && github.event.label.name == 'CI') }}
    steps: [run: echo]
    outputs:
      TEST_RESULT_PATH: ${{ env.TEST_RESULT_PATH }}